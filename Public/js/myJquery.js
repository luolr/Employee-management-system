window.onload=function(){$('input[name="username"]').on("blur",function(){if($(this).val()==null||$(this).val().trim()==""){layer.tips('用户名不能为空',this,{tips:2})}});$('input[name="password"]').on("blur",function(){if($(this).val()==null||$(this).val().trim()==""){layer.tips('密码不能为空',this,{tips:2})}});$('#main-nav li a.nav-top-item').on("click",function(){$(this).parent().siblings().find("ul").slideUp("normal");$(this).next().slideToggle("normal");return false});$('#main-nav li').on("mouseenter",function(){$(this).stop().find('.nav-top-item').animate({'padding-right':'25px'},300)});$('#main-nav li').on("mouseleave",function(){$(this).stop().find('.nav-top-item').animate({'padding-right':'15px'},300)});$('#main-content tbody tr:even').css('background','#f3f3f3');$('.check-all').on("click",function(){if(true==$(this).attr('checked')){$("input[type='checkbox']").attr('checked',false)}else{$("input[type='checkbox']").attr('checked',$(this).is(':checked'))}});$("input[type='checkbox']").each(function(){$(this).attr('value',$(this).parent().parent().find('.time').text())});$("input[type='checkbox']").on("click",function(){if(true==$(this).attr('checked')){$(this).attr('checked',false)}else{$(this).attr('checked',$(this).is(':checked'))}});$('.content-box-tabs li a').on("click",function(){$(this).parent().siblings().find('a').removeClass('current');$(this).addClass('current');var target=$(this).attr('href');$(target).siblings().hide();$(target).show();return false});$('.email-header h3').on("click",function(){$(this).parent().parent().find('.content-box-header').toggleClass('content-box-header-bottom');$(this).parent().parent().find('.content-box-content').toggle();$(this).parent().find('.content-box-tabs').toggle()});$('.email .content-box-content table tbody tr td:nth-of-type(5)').each(function(){if($(this).text()=='重要邮件'){$(this).parent().css({'color':'#ff0000'})}});$('.img_read').on("click",function(){var time=$(this).parent().parent().find('.time').text();$.post(readUrl,{time:time},function(data){if(data.status==1){layer.open({type:1,area:['500px','390px'],title:'邮件',maxmin:true,shadeClose:true,content:'<div class="read_email_box">'+'<p><label>收 件 人 ：</label>'+data.Recipient+'</p>'+'<p><label>发 件 人 ：</label>'+data.Sender+'</p>'+'<p><label>时      间 ：</label>'+data.Time+'</p>'+'<p><label>主      题 ：</label>'+data.Topic+'</p>'+'<p><label>类      型 ：</label>'+data.Type+'</p>'+'<label for="textArea">正       文：</label>'+'<div class="contentBox">'+data.Content+'</div>'+'</div>'})}else if(data.status==2){alert('没有这封邮件')}})});$('.img_reply').on("click",function(){$('li#two a').addClass('current');$('li#one a').removeClass('current');$('div#tab1').hide();$('div#tab2').show();$('#email-recipient').attr('value',$(this).parent().parent().find('.sender').text());$('#email-topic').focus()});$('.img_delete').on("click",function(){var time=$(this).parent().parent().find('.time').text();var index=$(this).parent().parent().index();$.post(singularUrl,{time:time,index:index},function(data){if(data.status==1){$('#itemContainer').children().eq(data.index).remove();$('#main-content tbody tr').css('background','#ffffff');$('#main-content tbody tr:even').css('background','#f3f3f3');layer.tips('删除成功','#tab1 thead tr th:nth-of-type(7)',{tips:[2,'#68AF02']})}else if(data.status==2){layer.tips('删除失败','#tab1 thead tr th:nth-of-type(7)')}else{layer.tips('未知错误','#tab1 thead tr th:nth-of-type(7)')}})});$('#email_apply').on("click",function(){var array=new Array();$("input[type='checkbox'][checked]").each(function(){array.push($(this).attr('value'))});if($(this).parent().find('select').val()=='option2'){$.post(applyUrl,{array:array},function(data){if(data.status==1){$("input[type='checkbox'][checked]").parent().parent().remove();$('#main-content tbody tr').css('background','#ffffff');$('#main-content tbody tr:even').css('background','#f3f3f3');layer.tips('删除成功','#email_apply',{tips:[2,'#68AF02']})}else if(data.status==2){layer.tips('请选择需要删除的邮件','#email_apply')}else{layer.tips('删除失败','#email_apply')}})}});$(".pagination").jPages({containerID:"itemContainer",perPage:5,delay:100});$('.itemsPerPage').find('select').change(function(){var newPerPage=parseInt($(this).val());$(".pagination").jPages("destroy").jPages({containerID:"itemContainer",perPage:newPerPage})});$('.menuList').on("click",function(){$(this).parent().siblings().find('.menuList').removeClass('active');$(this).addClass('active');$(this).parent().find('.subMenu').toggle()});$('.subMenu').on("mouseover",function(){$(this).css('display','block')});$('.subMenu').on("mouseleave",function(){$(this).css('display','none')});$('.send-email').on("click",function(){var recipient=$(this).parent().parent().find('.thisName').text();layer.open({type:1,area:['500px','625px'],title:'写信',maxmin:true,shadeClose:true,content:'<div class="send-email-box">'+'<p><label for="email_recipient">收件人：</label>'+'<input type="text" name="recipient" id="email_recipient" value="'+recipient+'"/></p>'+'<p><label for="email_topic">主   题：</label>'+'<input type="text" name="topic" id="email_topic" required/></p>'+'<p><label for="email_type">类    型：</label>'+'<select name="type" id="email_type">'+'<option value="option1">普通邮件</option>'+'<option value="option2">重要邮件</option>'+'</select></p><hr/>'+'<label for="textArea">正   文：</label>'+'<textarea id="textArea"></textarea>'+'<p><button class="button" id="send_btn" style="width: 80px">发送</button></p>'+'</form>'+'</div>'});$("textarea[id='textArea']").qeditor({});});$('body').on('click','#send_btn',function(){var recipient=$('#email_recipient');var topic=$('#email_topic');var type=$('#email_type');var content=$(this).parent().parent().find('.qeditor_border').find('.qeditor_preview');if(recipient.val()==null||recipient.val()==''){layer.tips('收件人不能为空！',recipient);return false}if(topic.val()==null||topic.val()==''){layer.tips('主题不能为空！',topic);return false}$.post(sendUrl,{recipient:recipient.val(),topic:topic.val(),type:type.val(),content:content.val()},function(data){if(data.status==1){$('.layui-layer-close.layui-layer-close1').click();layer.alert('邮件发送成功',{icon:6})}else if(data.status==2){layer.alert('邮件发送失败',{icon:5})}})});$('.delete-contact').on("click",function(){var contactName=$(this).parent().parent().find('.thisName').text();var index=$(this).parent().parent().index();layer.confirm('确认要删除该联系人？',{icon:0},function(){$.post(deleteUrl,{contactName:contactName},function(data){if(data.status==1){layer.alert('删除成功',{icon:1});$('#itemContainer').children().eq(index).remove()}else if(data.status==2){layer.alert('删除失败',{icon:5})}else{layer.alert('未知错误')}})})});$('.invitation').on("click",function(){layer.open({type:1,area:['400px','200px'],title:'添加新的联系人',shadeClose:true,content:'<div class="add-contact-box">'+'<p><label for="contactName">'+'<i style="margin-left:6px;color: red">*</i>联系人姓名:</label>'+'<input type="text" name="contactName" id="contactName"/></p>'+'<p><label for="contactPhone">'+'<i style="margin-left:6px;color: red">*</i>联系人电话:</label>'+'<input type="text" name="contactPhone" id="contactPhone"/></p>'+'<button class="button" id="add_btn">发送请求</button></div>'})});$('body').on('click','#add_btn',function(){var contactName=$('#contactName').val();var contactPhone=$('#contactPhone').val();if(contactName==null||contactName==''){layer.tips('姓名不能为空！','#contactName');return false}if(contactPhone==null||contactPhone==''){layer.tips('电话不能为空！','#contactPhone');return false}$.post(addUrl,{contactName:contactName,contactPhone:contactPhone},function(data){if(data.status==1){$('.layui-layer-close.layui-layer-close1').click();layer.alert('请求已发出',{icon:6})}else if(data.status==2){layer.tips('用户不存在或信息错误！','#contactName')}else if(data.status==3){layer.tips('该用户已经是联系人！','#contactName')}})});$('input.required').on("blur",function(){if($(this).val()==null||$(this).val().trim()==""){layer.tips('该项不能为空',this,{tips:1})}});$('select[name="target1"]').on("blur",function(){if($(this).val()==0){layer.tips('主送目标不能为空',this,{tips:1})}});$('.sel-person').on("blur",function(){var target=$(this);var Number="/OA/index.php/Document/validation";if($(this).val()==null||$(this).val().trim()==""){layer.tips('目标姓名不能为空',this,{tips:1})}else{var name=$(this).val();$.post(validation,{name:name},function(data){if(data.status==1){layer.tips('通过验证',target,{tips:[1,'#69AD00']})}else if(data.status==2){layer.tips('目标对象不存在',target,{tips:[1,'#FF0000']})}})}});$('.DocumentID').on("blur",function(){var Number="/OA/index.php/Document/Number";var DocumentID=$(this).val();if($(this).val().length<5){layer.tips('请输入至少5位数的公文编号',this,{tips:1})}else{$.post(Number,{DocumentID:DocumentID},function(data){if(data.status==2){layer.tips('通过验证','.DocumentID',{tips:[1,'#69AD00']})}else if(data.status==1){layer.tips('该公文编号已被使用','.DocumentID',{tips:[1,'#FF0000']})}})}});$('.Document-target').on("click",function(){if($(this).val()=='1'){$(this).parent().find('.sel-person').hide();$(this).parent().find('.sel-department').show()}else if($(this).val()=='2'){$(this).parent().find('.sel-department').hide();$(this).parent().find('.sel-person').show()}else{$(this).parent().find('.sel-department').hide();$(this).parent().find('.sel-person').hide()}});$('.dc_operation .shenhe').on("click",function(){var documentId=$(this).parent().parent().find('.Number').text();var opinion=$(this).parent().parent().find('#opinion').find('textarea').val();var checkUrl="/OA/index.php/Document/check";var downloadUrl="/OA/index.php/Document/download/documentId/"+documentId;var passUrl="/OA/index.php/Document/pass/documentId/"+documentId;var backUrl="/OA/index.php/Document/back/documentId/"+documentId;$.post(checkUrl,{documentId:documentId},function(data){if(data.status==1){layer.open({type:1,title:'公文',area:['550px','570px'],shadeClose:true,content:'<div class="document_check">'+'<p class="ID"><label>公 文 编 号：</label><span>'+documentId+'</span></p>'+'<p><label>公 文 标 题：</label><span>'+data.Title+'</span></p>'+'<p><label>公文撰写人：</label><span>'+data.Author+'</span></p>'+'<p><label>主 送 目 标：</label><span>'+data.Target1+'</span></p>'+'<p><label>抄 送 目 标：</label><span>'+data.Target2+'</span></p>'+'<p><label>关    键   字：</label><span>'+data.Keyword+'</span></p>'+'<p><label>内 容 简 介：</label>'+'<textarea class="content-introduction">'+data.Introduction+'</textarea></p>'+'<p><label>附           件：</label>'+'<a href="'+downloadUrl+'" class="file"> '+data.FileName+'</a>'+'<p id="opinion"><label>意           见：</label>'+'<textarea name="" class="yijian"></textarea></p>'+'<p class="passOrNot"><button class="pass"><a href="'+passUrl+'">同意</a></button>'+'<button class="back"><a href="'+backUrl+$('.ID').val()+'">不同意</a></button></p></div>'})}})});$('body').on('blur','.yijian',function(){var documentId=$(this).parent().parent().find('.ID').find('span').text();var opinion=$(this).val();var target=$(this).parent().parent().find('.passOrNot').find('.pass').find('a');target.attr('href','/OA/index.php/Document/pass/documentId/'+documentId+'/opinion/'+opinion)});$('.dc_operation .yuedu').on("click",function(){var documentId=$(this).parent().parent().find('.Number').text();var readUrl="/OA/index.php/Document/read/documentId/"+documentId;var downloadUrl="/OA/index.php/Document/download/documentId/"+documentId;$.post(readUrl,{documentId:documentId},function(data){if(data.status==1){layer.open({type:1,title:'公文',area:['520px','530px'],shadeClose:true,content:'<div class="document_check">'+'<p><label>公 文 编 号：</label><span>'+documentId+'</span></p>'+'<p><label>公 文 标 题：</label><span>'+data.Title+'</span></p>'+'<p><label>公文撰写人：</label><span>'+data.Author+'</span></p>'+'<p><label>主 送 目 标：</label><span>'+data.Target1+'</span></p>'+'<p><label>抄 送 目 标：</label><span>'+data.Target2+'</span></p>'+'<p><label>关    键   字：</label><span>'+data.Keyword+'</span></p>'+'<p><label>内 容 简 介：</label>'+'<textarea class="content-introduction">'+data.Introduction+'</textarea></p>'+'<p><label>附           件：</label>'+'<a href="'+downloadUrl+'" class="file"> '+data.FileName+'</a>'+'<p><label>意           见：</label>'+'<textarea name="" class="yijian">'+data.Opinion+'</textarea></p>'});$(this).parent().parent().find('.IsRead').text()=='已读'}else{alert('公文不存在')}})});$('.dc_operation .chakan').on("click",function(){var documentId=$(this).parent().parent().find('.Number').text();var checkUrl="/OA/index.php/Document/read/documentId/"+documentId;var downloadUrl="/OA/index.php/Document/download/documentId/"+documentId;$.post(checkUrl,{documentId:documentId},function(data){if(data.status==1){layer.open({type:1,title:'公文',area:['550px','570px'],shadeClose:true,content:'<div class="document_check">'+'<p><label>公 文 编 号：</label><span>'+documentId+'</span></p>'+'<p><label>公 文 标 题：</label><span>'+data.Title+'</span></p>'+'<p><label>公文撰写人：</label><span>'+data.Author+'</span></p>'+'<p><label>主 送 目 标：</label><span>'+data.Target1+'</span></p>'+'<p><label>抄 送 目 标：</label><span>'+data.Target2+'</span></p>'+'<p><label>关    键   字：</label><span>'+data.Keyword+'</span></p>'+'<p><label>内 容 简 介：</label>'+'<textarea class="content-introduction">'+data.Introduction+'</textarea></p>'+'<p><label>附           件：</label>'+'<a href="'+downloadUrl+'" class="file"> '+data.FileName+'</a>'+'<p><label>状           态：</label><span>'+data.State+'</span></p>'+'<p><label>审   核   人：</label><span>'+data.Checker+' </span></p>'+'<p><label>意           见：</label>'+'<textarea name="" class="yijian">'+data.Opinion+'</textarea></p>'});$(this).parent().parent().find('.IsRead').text()=='已读'}else{alert('公文不存在')}})});$('.co_title').on("blur",function(){var title=$(this).val();var coTitle="/OA/index.php/Announcement/Title/title/"+title+"/type/1";if($(this).val()==null||$(this).val().trim()==''){layer.tips('标题不能为空','.co_title',{tips:1})}else{$.post(coTitle,{title:title},function(data){if(data.status==1){layer.tips('标题可用','.co_title',{tips:[1,'#69AD00']})}else if(data.status==2){layer.tips('标题已存在','.co_title',{tips:[1,'#FF0000']})}else{}})}});$('.de_title').on("blur",function(){var title=$(this).val();var deTitle="/OA/index.php/Announcement/Title/title/"+title+"/type/2";if($(this).val()==null||$(this).val().trim()==''){layer.tips('标题不能为空','.de_title',{tips:1})}else{$.post(deTitle,{title:title},function(data){if(data.status==1){layer.tips('标题可用','.de_title',{tips:[1,'#69AD00']})}else if(data.status==2){layer.tips('标题已存在','.de_title',{tips:[1,'#FF0000']})}else{}})}});$('.co_edit').on("click",function(){$('#two a').click();var title=$(this).parent().parent().find('.title').text();var getContentUrl='/OA/index.php/Announcement/getContent/title/'+title;$.post(getContentUrl,{title:title,type:1},function(data){$('.qeditor_preview').html(data.content)});$('.co_title').attr('value',title)});$('.de_edit').on("click",function(){$('#two a').click();var title=$(this).parent().parent().find('.title').text();var getContentUrl='/OA/index.php/Announcement/getContent/title/'+title;$.post(getContentUrl,{title:title,type:2},function(data){$('.qeditor_preview').html(data.content)});$('.de_title').attr('value',title)});$('.co_delete').on("click",function(){var time=$(this).parent().parent().find('.time').text();var deleteUrl='/OA/index.php/Announcement/delete';var index=$(this).parent().parent().index();layer.confirm('确认要删除该公告？',{icon:0},function(){$.post(deleteUrl,{time:time,type:1},function(data){if(data.status==1){layer.alert('删除成功',{icon:1});$('#itemContainer').find('tr').eq(index).remove()}else{layer.alert('删除失败',{icon:2})}})})});$('.de_delete').on("click",function(){var time=$(this).parent().parent().find('.time').text();var deleteUrl='/OA/index.php/Announcement/delete';var index=$(this).parent().parent().index();layer.confirm('确认要删除该公告？',{icon:0},function(){$.post(deleteUrl,{time:time,type:2},function(data){if(data.status==1){layer.alert('删除成功',{icon:1});$('#itemContainer').find('tr').eq(index).remove()}else{layer.alert('删除失败',{icon:2})}})})});$('#endTime').on("blur",function(){var startTime=$('#startTime');var endTime=$('#endTime');var type=$('select[name="days"]').val();var time1=new Date(startTime.val());var time2=new Date(endTime.val());var interval=(time2-time1)/(1000*3600*24);if(endTime.val()<startTime.val()){layer.alert('结束时间不能早于开始时间',{icon:7});endTime.attr('value','')}else{if((interval<=5&&type==2)){layer.alert('所填时间与请假天数不符',{icon:7});endTime.attr('value','')}else if(interval>5&&type==1){layer.alert('所填时间与请假天数不符',{icon:7});endTime.attr('value','')}}});$('#tiaokuan').on("click",function(){layer.open({type:1,title:'公司员工请假管理制度',area:['540px','570px'],maxmin:true,shadeClose:true,content:'<div class="tiaokuan_box">'+tiaokuan+'</div>'})});$('.leave_S_S').on("click",function(){var realName=$(this).parent().parent().find('#realName').text();var Url='/OA/index.php/Leave/getMessage.html';var agree='/OA/index.php/Leave/agree/realName/'+realName+'/days/S';var disagree='/OA/index.php/Leave/disagree/realName/'+realName+'/days/S';$.post(Url,{realName:realName,state:0},function(data){if(data.status==1){layer.open({type:1,title:'短假',area:['520px','400px'],shadeClose:true,content:'<div class="document_check">'+'<p><label>申    请   人：</label><span>'+data.realName+'</span></p>'+'<p><label>部           门：</label><span>'+data.department+'</span></p>'+'<p><label>请 假 类 型：</label><span>'+data.type+'</span></p>'+'<p><label>请 假 天 数：</label><span>'+data.days+'</span></p>'+'<p><label>开 始 时 间：</label><span>'+data.start+'</span></p>'+'<p><label>结 束 时 间：</label><span>'+data.end+'</span></p>'+'<p><label>请 假 理 由：</label>'+'<textarea class="content-introduction">'+data.reason+'</textarea></p>'+'<p class="passOrNot"><button class="pass"><a href="'+agree+'">同意</a></button>'+'<button class="back"><a href="'+disagree+'">不同意</a></button></p></div>'})}else{layer.alert('所查看的信息不存在',{icon:2})}})});$('.leave_L_S').on("click",function(){var realName=$(this).parent().parent().find('#realName').text();var Url='/OA/index.php/Leave/getMessage.html';var agree='/OA/index.php/Leave/agree/realName/'+realName+'/days/L';var disagree='/OA/index.php/Leave/disagree/realName/'+realName+'/days/L';$.post(Url,{realName:realName,state:1},function(data){if(data.status==1){layer.open({type:1,title:'短假',area:['520px','400px'],shadeClose:true,content:'<div class="document_check">'+'<p><label>申    请   人：</label><span>'+data.realName+'</span></p>'+'<p><label>部           门：</label><span>'+data.department+'</span></p>'+'<p><label>请 假 类 型：</label><span>'+data.type+'</span></p>'+'<p><label>请 假 天 数：</label><span>'+data.days+'</span></p>'+'<p><label>开 始 时 间：</label><span>'+data.start+'</span></p>'+'<p><label>结 束 时 间：</label><span>'+data.end+'</span></p>'+'<p><label>请 假 理 由：</label>'+'<textarea class="content-introduction">'+data.reason+'</textarea></p>'+'<p class="passOrNot"><button class="pass"><a href="'+agree+'">同意</a></button>'+'<button class="back"><a href="'+disagree+'">不同意</a></button></p></div>'})}else{layer.alert('所查看的信息不存在',{icon:2})}})});$('.message_delete').on("click",function(){var time=$(this).parent().parent().find('#time').text();var index=$(this).parent().parent().index();var url="/OA/index.php/Message/delete";layer.confirm('确认要删除该留言？',{icon:0},function(){$.post(url,{time:time},function(data){if(data.status==1){layer.alert('删除成功',{icon:1});$('#itemContainer').find('tr').eq(index).remove()}else{layer.alert('删除失败',{icon:2})}})})});$('.file_manager').on("click",function(){var realName=$(this).parent().parent().find('#realName').text();var url='/OA/index.php/File/setManager';layer.confirm('指定该员工为部门文件管理员?',{icon:7,title:'提示'},function(){$.post(url,{realName:realName},function(data){if(data.status==1){layer.alert('指定成功',{icon:6})}else if(data.status==2){layer.alert('指定失败',{icon:5})}else{layer.alert('未知错误',{icon:5})}})})});$(".file_download").each(function(){var id=$(this).parent().parent().find('#id').text();$(this).attr('href','/OA/index.php/File/download/id/'+id)});$(".file_delete").on("click",function(){var index=$(this).parent().parent().index();var id=$(this).parent().parent().find('#id').text();var url='/OA/index.php/File/delete.html';layer.confirm('确认要删除该文件？',{icon:7,title:'提示'},function(){$.post(url,{id:id},function(data){if(data.status==1){layer.alert('文件删除成功',{icon:1});$('#itemContainer').find('tr').eq(index).remove()}else if(data.status==2){layer.alert('文件为公文附件，不能删除',{icon:2})}else if(data.status==3){layer.alert('文件不存在',{icon:5})}else{layer.alert('未知错误',{icon:3})}})})});$('#de_name').on("change",function(){var name=$(this).val();var url="/OA/index.php/System/checkDeName";$.post(url,{name:name},function(data){if(data.status==2){layer.tips('可以创建','#de_name',{tips:[1,'#69AD00']})}else if(data.status==1){layer.tips('该部门已存在','#de_name',{tips:[1,'#ff0000']})}})});$('#de_manager').on("change",function(){var name=$(this).val();var url="/OA/index.php/System/checkName";if(name.trim()!=''&&name!=null){$.post(url,{name:name},function(data){if(data.status==1){layer.tips('可以指定','#de_manager',{tips:[1,'#69AD00']})}else if(data.status==2){layer.tips('用户不存在','#de_manager',{tips:[1,'#ff0000']})}})}});$('.system_de_edit').on("click",function(){var name=$(this).parent().parent().find('#name').text();layer.open({type:1,title:'部门编辑',area:['335px','200px'],shadeClose:true,content:'<div class="editBox"><p><label>部门名称:</label>'+'<span id="oldName">'+name+'</span></p>'+'<p><label>新的名称:</label>'+'<input type="text" id="newName" value=""></p>'+'<p><button class="button de_edit_btn">保存</button></p></div>'})});$('body').on('click','.de_edit_btn',function(){var oldName=$(this).parent().parent().find('#oldName').text();var newName=$(this).parent().parent().find('#newName').val();var deEditUrl="/OA/index.php/System/de_edit";var checkDeUrl="/OA/index.php/System/checkDeName";if(newName==''||newName==null){layer.alert("部门新名称不能为空!",{icon:0})}else{$.post(checkDeUrl,{name:newName},function(data){if(data.status==1){layer.alert("部门已存在!",{icon:0})}else if(data.status==2){$.post(deEditUrl,{oldName:oldName,newName:newName},function(data){if(data.status==1){layer.alert("编辑成功!",{icon:6})}else{layer.alert("编辑失败!",{icon:5})}})}})}});$('.system_de_delete').on("click",function(){var name=$(this).parent().parent().find('#name').text();var index=$(this).parent().parent().index();var deleteUrl='/OA/index.php/System/de_delete';layer.confirm('确认要删除<strong>'+name+'</strong>？',{icon:0},function(){$.post(deleteUrl,{departmentName:name},function(data){if(data.status==1){layer.alert('删除成功',{icon:1});$('#itemContainer').children().eq(index).remove()}else if(data.status==2){layer.alert('删除失败',{icon:5})}else{layer.alert('未知错误',{icon:0})}})})});$('p#role').on("change",function(){var role=$(this).find('select').val();if(role==3||role==4){$('p.department').show()}else{$('p.department').hide()}});$('#realName').on("change",function(){var name=$(this).val();var url="/OA/index.php/System/checkName";if(name.trim()!=''&&name!=null){$.post(url,{name:name},function(data){if(data.status==1){layer.tips('用户已存在','#realName',{tips:[1,'#ff0000']})}else if(data.status==2){layer.tips('可以新增','#realName',{tips:[1,'#69AD00']})}})}});$('input[name="userName"]').on("change",function(){var name=$(this).val();var url="/OA/index.php/System/checkUserName";if(name.trim()!=''&&name!=null){$.post(url,{username:name},function(data){if(data.status==1){layer.tips('用户名已存在','input[name="userName"]',{tips:[1,'#ff0000']})}else if(data.status==2){layer.tips('用户名可用','input[name="userName"]',{tips:[1,'#69AD00']})}})}});$('.system_em_edit').on("click",function(){var name=$(this).parent().parent().find('#name').text();var telephone=$(this).parent().parent().find('#telephone').text();var email=$(this).parent().parent().find('#email').text();var department=$(this).parent().parent().find('#department').text();var role=$(this).parent().parent().find('#role').text();layer.open({type:1,title:'员工编辑',area:['350px','325px'],shadeClose:true,content:'<div class="editBox"><p><label>真实姓名:</label>'+'<span id="name">'+name+'</span></p>'+'<p><label>联系电话:</label>'+'<input type="text" id="telephone" value="'+telephone+'"></p>'+'<p><label>电子邮件:</label>'+'<input type="text" id="email" value="'+email+'"></p>'+'<p><label>角色分配:</label>'+'<select id="newRole">'+'<option value="0">不变</option>'+'<option value="1">总经理</option>'+'<option value="2">总经理秘书</option>'+'<option value="3">部门经理</option>'+'<option value="4">普通员工</option></select></p>'+'<p><label>所属部门:</label>'+'<input type="text" id="department" value="'+department+'"></p>'+'<p style="display: none"><label>角色:</label>'+'<input type="text" id="oldRole" value="'+role+'"></p>'+'<p><button class="button em_edit_btn">保存</button></p></div>'})});$('body').on('click','.em_edit_btn',function(){var name=$(this).parent().parent().find('#name').text();var telephone=$(this).parent().parent().find('#telephone').val();var email=$(this).parent().parent().find('#email').val();var newRole=$(this).parent().parent().find('#newRole').val();var oldRole=$(this).parent().parent().find('#oldRole').val();var department=$(this).parent().parent().find('#department').val();var checkDeUrl="/OA/index.php/System/checkDeName";var saveUrl="/OA/index.php/System/em_edit";if(role=='1'||role=='2'){$.post(saveUrl,{name:name,telephone:telephone,email:email,role:newRole},function(data){if(data.status==1){layer.alert("修改成功1!")}else if(data.status==2){layer.alert("修改失败1!")}})}else{$.post(checkDeUrl,{name:department},function(data){if(data.status==2){layer.alert("部门不存在!",{icon:2})}else if(data.status==1){$.post(saveUrl,{name:name,telephone:telephone,email:email,role:newRole,department:department},function(data){if(data.status==1){layer.alert("修改成功2!")}else if(data.status==2){layer.alert("修改失败2!")}})}})}});$('.system_em_delete').on("click",function(){var name=$(this).parent().parent().find('#name').text();var index=$(this).parent().parent().index();var deleteUrl='/OA/index.php/System/em_delete.html';layer.confirm('确认要删除员工<strong>'+name+'</strong>？',{icon:0},function(){$.post(deleteUrl,{employeeName:name},function(data){if(data.status==1){layer.alert('删除成功',{icon:1});$('#itemContainer').children().eq(index).remove()}else if(data.status==2){layer.alert('删除失败',{icon:5})}else{layer.alert('未知错误')}})})});var textArea=$("textarea[id='textArea']");textArea.qeditor({});var toolbar=textArea.parent().find(".qeditor_toolbar");var link=$("<a href='#'><span class='icon-smile'></span></a>");link.click(function(){alert("Put you custom toolbar event in here.");return false});toolbar.append(link)}